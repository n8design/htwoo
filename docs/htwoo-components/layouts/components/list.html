{{ define "main" }}
<!-- Component page styles -->
{{ partial "component-styles.html" . }}
<!-- component list template -->
<article id="content" class="t-component-list">
  <!-- Under Construction Notice -->
  <div class="under-construction">
    <strong>ðŸš§ Under Construction</strong>
    <p>This component documentation is currently being developed. Some features may be incomplete.</p>
  </div>

  <!-- Breadcrumb (only for subcategories, not for root components page) -->
  {{ if .Params.category }}
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li><a href="{{ .Site.BaseURL }}components/">Components</a></li>
      {{ if and .Params.category (not .Params.subcategory) }}
      <li aria-current="page">{{ .Params.category | title }}</li>
      {{ else if .Params.subcategory }}
      <li><a href="{{ .Site.BaseURL }}components/{{ .Params.category }}/">{{ .Params.category | title }}</a></li>
      <li aria-current="page">{{ .Params.subcategory | title }}</li>
      {{ end }}
    </ol>
  </nav>
  {{ end }}

  <header>
    <h1>{{ .Title }}</h1>
    {{ if .Description }}
    <p class="intro">{{ .Description }}</p>
    {{ end }}
  </header>

  {{ .Content }}

  <!-- Search (only on main components page) -->
  {{ if not .Params.category }}
  <div class="search-container">
    <input type="search" id="search-input" placeholder="Search components..." autocomplete="off">
    <div id="search-results"></div>
  </div>
  {{ end }}

  <!-- List sections or components -->
  {{ if .Sections }}
  <div class="category-grid">
    {{ range .Sections }}
    <a href="{{ .Permalink }}" class="category-card">
      <h3>{{ .Title }}</h3>
      <p>{{ len .RegularPagesRecursive }} components</p>
    </a>
    {{ end }}
  </div>

  <!-- A-Z Component Index (only on main components page) -->
  {{ if not .Params.category }}
  <section class="az-index">
    <h2>All Components A-Z</h2>

    <!-- Letter navigation -->
    <nav class="az-nav" aria-label="Alphabetical navigation">
      {{ $allPages := slice }}
      {{ range .Sections }}
        {{ range .RegularPagesRecursive }}
          {{ $allPages = $allPages | append . }}
        {{ end }}
      {{ end }}
      {{ $letters := slice }}
      {{ range $allPages }}
        {{ $firstLetter := upper (substr .Title 0 1) }}
        {{ if not (in $letters $firstLetter) }}
          {{ $letters = $letters | append $firstLetter }}
        {{ end }}
      {{ end }}
      {{ range (sort $letters) }}
      <a href="#letter-{{ . }}" class="az-letter">{{ . }}</a>
      {{ end }}
    </nav>

    <!-- Grouped component list -->
    <div class="az-list">
      {{ $allPages := slice }}
      {{ range .Sections }}
        {{ range .RegularPagesRecursive }}
          {{ $allPages = $allPages | append . }}
        {{ end }}
      {{ end }}
      {{ $sortedPages := sort $allPages "Title" }}
      {{ $currentLetter := "" }}
      {{ range $sortedPages }}
        {{ $firstLetter := upper (substr .Title 0 1) }}
        {{ if ne $firstLetter $currentLetter }}
          {{ if $currentLetter }}
          </ul>
          {{ end }}
          {{ $currentLetter = $firstLetter }}
          <h3 id="letter-{{ $firstLetter }}" class="az-letter-heading">{{ $firstLetter }}</h3>
          <ul class="az-component-list">
        {{ end }}
        <li>
          <a href="{{ .Permalink }}">{{ .Title }}</a>
          <span class="az-category">{{ .Params.category }}{{ if .Params.subcategory }} / {{ .Params.subcategory }}{{ end }}</span>
        </li>
      {{ end }}
      {{ if $currentLetter }}</ul>{{ end }}
    </div>
  </section>
  {{ end }}

  {{ else }}
  <!-- List individual components -->
  <div class="component-grid">
    {{ range .Pages }}
    <a href="{{ .Permalink }}" class="component-card">
      <h3>{{ .Title }}</h3>
      {{ if .Description }}
      <p>{{ .Description | truncate 100 }}</p>
      {{ end }}
    </a>
    {{ end }}
  </div>
  {{ end }}
</article>

{{ if not .Params.category }}
<script src="{{ .Site.BaseURL }}htwoo-components/js/components.js"></script>
{{ end }}
<!-- component list template -->
{{ end }}
